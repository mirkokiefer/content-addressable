// Generated by CoffeeScript 1.3.3
(function() {
  var ContentAddressable, computeHash;

  computeHash = require('sha1');

  ContentAddressable = (function() {

    function ContentAddressable(_arg) {
      this.store = _arg.store;
    }

    ContentAddressable.prototype.write = function(data, cb) {
      var hash;
      hash = computeHash(data);
      this.store.write(hash, data);
      if (cb) {
        return cb(null, hash);
      } else {
        return hash;
      }
    };

    ContentAddressable.prototype.read = function(hash, cb) {
      return this.store.read(hash, cb);
    };

    ContentAddressable.prototype.writeAll = function(data, cb) {
      var each, key, keyValues, value, _i, _len, _ref, _results;
      keyValues = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          each = data[_i];
          _results.push({
            key: computeHash(each),
            value: each
          });
        }
        return _results;
      })();
      this.store.writeAll(keyValues, cb);
      _results = [];
      for (_i = 0, _len = keyValues.length; _i < _len; _i++) {
        _ref = keyValues[_i], key = _ref.key, value = _ref.value;
        _results.push(key);
      }
      return _results;
    };

    ContentAddressable.prototype.readAll = function(hashs, cb) {
      return this.store.readAll(hashs, cb);
    };

    return ContentAddressable;

  })();

  module.exports = {
    Interface: ContentAddressable,
    memory: function() {
      return new ContentAddressable({
        store: require('pluggable-store').server().memory()
      });
    },
    fileSystem: function() {
      return new ContentAddressable({
        store: require('pluggable-store').server().fileSystem()
      });
    }
  };

}).call(this);
